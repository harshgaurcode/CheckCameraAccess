<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Upload with Resize</title>
    <style>
        #loader {
            display: none;
            color: blue;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Open Camera and Upload Picture</h1>
    <div id="cameraNotFound" style="display:none; color:red;">Camera not found or access denied.</div>
    <div id="loader">Processing image...</div>

    <!-- Hidden file input for camera -->
    <input type="file" id="cameraInput" accept="image/*" capture="user" style="display:none;">

    <!-- Visible button to trigger the camera -->
    <button id="uploadButton">Open Camera</button>

    <!-- Preview captured image -->
    <img id="previewImage" style="display:none; max-width: 100%;" alt="Captured Image">

    <script>
        const uploadButton = document.getElementById('uploadButton');
        const cameraInput = document.getElementById('cameraInput');
        const cameraNotFound = document.getElementById('cameraNotFound');
        const previewImage = document.getElementById('previewImage');
        const loader = document.getElementById('loader');
        let hasCameraAccess = false;

        // Check if the device has camera access on page load
        function checkCameraAccess() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                hasCameraAccess = false;
                cameraNotFound.style.display = 'block';
                uploadButton.style.display = 'none';
            } else {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        hasCameraAccess = true;
                        cameraNotFound.style.display = 'none';
                        uploadButton.style.display = 'block';
                        stream.getTracks().forEach(track => track.stop());
                    })
                    .catch(() => {
                        hasCameraAccess = false;
                        cameraNotFound.style.display = 'block';
                        uploadButton.style.display = 'none';
                    });
            }
        }

        // Call camera check on page load
        checkCameraAccess();

        // Handle upload button click
        uploadButton.addEventListener('click', () => {
            if (hasCameraAccess) {
                cameraInput.click();
            } else {
                cameraNotFound.style.display = 'block';
            }
        });

        // Handle image selection or capture
        cameraInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                loader.style.display = 'block'; // Show loader
                const reader = new FileReader();

                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Set canvas dimensions to 512x512
                        canvas.width = 512;
                        canvas.height = 512;

                        // Draw and resize the image
                        ctx.drawImage(img, 0, 0, 512, 512);

                        // Convert the canvas to a Data URL
                        const resizedImageURL = canvas.toDataURL('image/jpeg');

                        // Display the resized image
                        previewImage.src = resizedImageURL;
                        previewImage.style.display = 'block';
                        loader.style.display = 'none'; // Hide loader
                    };

                    img.src = e.target.result;
                };

                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
